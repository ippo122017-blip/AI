# サーキットタイマー アプリ要件・設計メモ（スマホ展開準備）

最終更新: 2025-12-06

## 1. 背景と目的
- 既存: `python/circuit_timer.py`でCLI/Tkinter UIを提供し、ローカルJSON(`menus.json`)にメニューを保存。
- 目標: iOS/Androidで同等以上の体験（通知/振動/音/バックグラウンド実行）を実現し、将来的に他デバイスともデータ共有できる構成へ拡張する。

## 2. ステークホルダー
- **エンドユーザー**: 自宅やジムでサーキットトレーニングを行う個人ユーザー。
- **プロダクトオーナー**: 現アプリ開発者（本プロジェクトオーナー）。
- **サポート役**: 将来のデザイナー、クラウドエンジニア（必要に応じてアサイン）。

## 3. 想定利用シーン
1. 自宅トレ中にスマホ片手でタイマーを操作。画面ロック中でも通知/振動で次フェーズを認識したい。
2. メニューを複数デバイスで共有（例: タブレットで編集→スマホで実行）。
3. インターバル切り替え時に視覚/聴覚/触覚でフィードバックを受けたい。

## 4. 要件定義

### 4.1 機能要件
| ID | 要件 | 優先度 | 備考 |
|----|------|--------|------|
| F-01 | トレーニングメニューのCRUD（名称/セット秒数/休憩秒数/セット数） | Must | 既存JSON互換を維持しつつAPI化も視野 |
| F-02 | タイマー再生/一時停止/停止/再開 | Must | 背景実行と通知連携必須 |
| F-03 | 作業/休憩の音・振動通知 | Should | 端末の設定と連動、音量調整 |
| F-04 | 記録保存（履歴、完了日時） | Should | スマホ版追加機能候補 |
| F-05 | アカウント／同期（将来） | Could | MVPではローカル保存に留める |
| F-06 | 多言語対応（JP/EN） | Could | UIテキストをリソース化 |

### 4.2 非機能要件
- **レスポンス**: 画面遷移/操作への応答は200ms以内、タイマーは±100msの精度。
- **可用性**: オフライン完結を前提、同期機能追加後もオフライン時にメニュー閲覧/実行可。
- **アクセシビリティ**: コントラスト比4.5:1以上、ボタンタップ領域44px以上、VoiceOver/TalkBack対応。
- **セキュリティ**: 同期実装時はHTTPS+認証トークン。ローカル保存はOS標準ストレージを使用。

### 4.3 制約・前提
- MVPは端末ローカルDB（例: SQLite/Room/CoreData）で完結。
- Python版資産はビジネスロジックの参照用途。最終的なモバイル実装はネイティブorクロスプラットフォーム（Flutter/React Native等）で再構築。
- `menus.json`互換のスキーマ（name, set_seconds, rest_seconds, sets）を維持し、移行スクリプトを用意する。

## 5. アーキテクチャ方針（案）
- **プレゼンテーション層**: モバイルUIフレームワーク（例: Flutter）で画面を定義。状態管理はRiverpod等を想定。
- **ドメイン層**: `TrainingMenu`, `TimerSequence`, `TimerController`などをUIから切り離し、デスクトップ版からロジックを移植しやすくする。
- **データ層**:
  - MVP: 端末ローカルDBでメニュー永続化。
  - 将来: REST/GraphQL/API Gatewayを介してクラウド同期（AWS Amplify/Firebase候補）。
- **通知層**: OS通知・振動APIをカバーするアブストラクションを用意。
- **構成図（テキスト）**:  
  `UI画面` ⇄ `状態管理(ViewModel)` ⇄ `ドメインサービス(タイマー/メニュー)` ⇄ `リポジトリ` ⇄ `ローカルDB/同期API`

## 6. 機能設計／仕様要約

### 6.1 データモデル
- `TrainingMenu`: { id(UUID), name, set_seconds, rest_seconds, sets, created_at, updated_at }
- `WorkoutSession`: { id, menu_id, started_at, completed_sets, duration_seconds }
- `TimerPhase`: 実行時に生成。(`label`, `duration`, `set_index`, `total_sets`) は現行Python版と同等。

### 6.2 画面仕様（MVP）
1. **ホーム/メニュー一覧**
   - メニューカード表示、検索、選択で詳細パネル表示。
   - FABまたはボタンで新規作成。
2. **メニュー編集**
   - 入力項目: 名前、作業時間、休憩時間、セット数。
   - バリデーション: 1秒以上、最大600秒（暫定）、セット数1–20。
3. **タイマー画面**
   - 残り時間、現在セット/総セット表示、進捗バー。
   - コントロール: 再生/一時停止/停止、次フェーズへスキップ。
   - バックグラウンド通知: 作業開始/休憩開始時に通知と振動パターンを送信。
4. **履歴（後続リリース）**
   - 実行履歴を一覧し、メニュー名・日時・完了セット数を表示。

### 6.3 タイマー状態遷移
```
Idle -> Running -> (Paused <-> Running) -> Completed
                    \-> Stopped -> Idle
```
- `Running`中は1秒毎に自動カウント。アプリがバックグラウンドへ移動した場合はOSのバックグラウンドタスク/通知で残り時間を更新。

### 6.4 API/ストレージ仕様（MVP）
- `menus`テーブル: 主キー`id`, ユニーク`name`.
- ローカル保存形式: JSON互換のため、インポート/エクスポート機能を提供。
- 同期機能構想: `/api/menus` GET/POST/PUT/DELETE, `/api/sessions` GET/POST。

## 7. 移行と段階的ロードマップ
1. **ドメイン分離**: 既存Pythonのタイマー/メニュー処理をクラス化し、UI依存を排除。
2. **設計スパイク**: Flutter or React NativeでプロトタイプUIを作り、タイマー精度を検証。
3. **MVP実装**: ローカル保存＋通知対応のモバイルアプリをStore外配布でテスト。
4. **同期/履歴強化**: クラウドAPIを導入し、複数デバイス同期と履歴分析を実装。
5. **公開準備**: 多言語対応、プライバシーポリシー、アプリ審査要件を整備。

## 8. 今後のドキュメント化タスク
- 画面遷移図・ワイヤーフレーム
- 詳細API設計（エンドポイント、ペイロード例）
- テスト計画（タイマー精度、通知、ローカライゼーション）
- リスク登録表（バックグラウンド制限、OSごとの通知仕様差異 など）

---
本メモはモバイル展開に向けた初期整理です。実装フェーズ前に、各章を詳細ドキュメント（要件定義書・基本設計書・詳細設計書）へ発展させてください。
